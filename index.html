<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AcaDexa - Advanced Scheduling Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>

    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        :root { --fc-border-color: #e2e8f0; --fc-neutral-bg-color: rgba(241, 245, 249, 0.5); --fc-event-text-color: #fff; }
        html.dark { --fc-border-color: #374151; --fc-neutral-bg-color: rgba(31, 41, 55, 0.5); }
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        .dark body { background-color: #111827; color: #e5e7eb; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .modal { transition: opacity 0.3s, visibility 0.3s; visibility: hidden; opacity: 0; }
        .modal.visible { visibility: visible; opacity: 1; }
        .modal-content { transition: transform 0.3s ease-out; transform: translateY(20px) scale(0.98); }
        .modal.visible .modal-content { transform: translateY(0) scale(1); }
        .fc .fc-button { @apply bg-indigo-600 border-indigo-600 hover:bg-indigo-700 text-white; }
        .fc .fc-daygrid-day.fc-day-today { @apply bg-indigo-50 dark:bg-indigo-900/20; }
        .fc-event.absent { @apply opacity-50 line-through bg-gray-500; }
    </style>
</head>
<body class="dark:bg-gray-900 dark:text-slate-200">

    <header class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <a href="#" class="text-3xl font-bold font-poppins tracking-tight">Aca<span class="text-indigo-500">Dexa</span></a>
            <div class="flex items-center gap-2 sm:gap-4">
                <div id="auth-container" class="flex items-center gap-2 sm:gap-4">
                    <button id="student-login-btn" class="text-sm font-semibold hover:text-indigo-600 dark:hover:text-indigo-400 transition">Student Login</button>
                    <button id="staff-login-btn" class="text-sm font-semibold bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">Staff Login</button>
                    <button id="admin-login-btn" class="text-sm font-semibold bg-amber-500 text-white px-4 py-2 rounded-lg hover:bg-amber-600 transition">Admin Login</button>
                </div>
                <div id="user-info-container" class="hidden items-center gap-4">
                     <button id="notifications-btn" class="relative p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700">
                        <i data-lucide="bell"></i>
                        <span id="notification-badge" class="absolute top-0 right-0 h-4 w-4 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center hidden"></span>
                    </button>
                    <button id="attendance-btn" class="flex items-center gap-2 text-sm font-semibold bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition">
                        <i data-lucide="fingerprint" class="w-4 h-4"></i> Attendance
                    </button>
                    <span class="font-semibold" id="username-display"></span>
                    <button id="logout-btn" class="text-sm font-semibold hover:text-indigo-600 dark:hover:text-indigo-400 transition">Logout</button>
                </div>
                <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700">
                    <i data-lucide="moon"></i>
                </button>
            </div>
        </nav>
    </header>

    <main id="main-content" class="container mx-auto p-4 sm:p-6">
        <div id="welcome-screen">
             <div class="text-center pt-12 pb-16">
                <h1 class="text-5xl md:text-6xl font-extrabold font-poppins tracking-tight">Welcome to Aca<span class="text-indigo-500">Dexa</span></h1>
                <p class="mt-4 text-lg text-slate-600 dark:text-slate-300">Your intelligent solution for academic scheduling and management.</p>
            </div>
        </div>
        <div id="app-wrapper" class="hidden">
            <div id="student-dashboard" class="hidden"></div>
            <div id="staff-dashboard" class="hidden"></div>
            <div id="schedule-view" class="mt-6 grid grid-cols-1 lg:grid-cols-4 gap-6">
                <div id="staff-schedule-tools" class="lg:col-span-1 bg-white dark:bg-gray-800/50 p-4 rounded-xl shadow-md">
                    <h3 class="font-bold text-lg mb-4">Scheduling Tools</h3>
                    <div id="available-subjects" class="space-y-2"></div>
                </div>
                <div class="lg:col-span-3 bg-white dark:bg-gray-800/50 p-4 sm:p-6 rounded-xl shadow-md">
                    <div id="schedule-controls" class="flex flex-wrap gap-4 justify-between items-center mb-6">
                        <select id="schedule-selector" class="p-2 rounded-md bg-white dark:bg-gray-700 border border-slate-300 dark:border-gray-600"></select>
                        <div id="staff-schedule-filters" class="flex items-center gap-2">
                            <label for="staff-view-selector" class="text-sm font-medium">View as:</label>
                            <select id="staff-view-selector" class="p-2 rounded-md bg-white dark:bg-gray-700 border border-slate-300 dark:border-gray-600"></select>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="print-btn" class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-gray-700" title="Print Schedule"><i data-lucide="printer"></i></button>
                            <button id="download-btn" class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-gray-700" title="Download as ICS"><i data-lucide="download"></i></button>
                        </div>
                    </div>
                    <div id="calendar-container"></div>
                </div>
            </div>
        </div>
    </main>
    
    <button id="ask-ai-btn" class="hidden fixed bottom-6 right-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full h-16 w-16 flex items-center justify-center shadow-lg z-40"><i data-lucide="bot" class="w-8 h-8"></i></button>
    <div id="toast" class="fixed top-24 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-2 px-5 rounded-lg shadow-lg opacity-0 transform -translate-y-10 z-[90] transition-all duration-300">
        <p id="toast-message"></p>
    </div>

    <div id="modals-container"></div>
    <script type="text/template" id="modals-template">
        <div id="login-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-[70] flex items-center justify-center p-4">
            <div class="modal-content bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl max-w-sm w-full relative">
                <button class="close-modal-btn absolute top-4 right-4 text-slate-500 hover:text-indigo-500"><i data-lucide="x"></i></button>
                <h3 id="login-title" class="text-2xl font-bold mb-6 text-center font-poppins">Login</h3>
                <form id="auth-form">
                    <input type="email" id="auth-email" placeholder="Email" class="w-full p-3 mb-4 border rounded-lg dark:bg-gray-700 dark:border-gray-600" required>
                    <input type="password" id="auth-password" placeholder="Password" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" required>
                    <p id="auth-error" class="text-red-500 text-sm mt-2 h-4"></p>
                    <button type="submit" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg">Login</button>
                </form>
            </div>
        </div>
        <div id="class-details-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4">
             <div class="modal-content bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl max-w-md w-full relative">
                <button class="close-modal-btn absolute top-4 right-4 text-slate-500 hover:text-indigo-500"><i data-lucide="x"></i></button>
                <h3 id="class-modal-title" class="text-2xl font-bold"></h3>
                <p id="class-modal-time" class="text-slate-500 mb-4"></p>
                <div class="space-y-3 pt-4 border-t dark:border-gray-700">
                    <div id="notes-container" class="border-t dark:border-gray-700 pt-3 mt-3">
                        <h4 class="font-bold mb-2 flex items-center gap-2"><i data-lucide="notebook-text"></i> Lecture Notes</h4>
                        <div id="class-modal-notes-content" class="text-sm"></div>
                    </div>
                    <div id="action-container" class="mt-4 flex flex-col gap-2"></div>
                </div>
            </div>
        </div>
        <div id="student-attendance-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-[90] flex items-center justify-center p-4">
             <div class="modal-content bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl max-w-lg w-full relative">
                <button class="close-modal-btn absolute top-4 right-4 text-slate-500 hover:text-indigo-500"><i data-lucide="x"></i></button>
                <h3 class="text-2xl font-bold mb-4 font-poppins">Mark Student Attendance</h3>
                <div id="student-list-container" class="space-y-2 max-h-80 overflow-y-auto"></div>
                <button id="save-student-attendance-btn" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-lg">Save Attendance</button>
            </div>
        </div>
        <div id="ai-chat-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-[80] flex items-end justify-end p-4">
            <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-md h-[70vh] flex flex-col">
                <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="bot" class="text-indigo-500"></i> AcaDexi Assistant</h3>
                    <button class="close-modal-btn text-slate-500 hover:text-indigo-500"><i data-lucide="x"></i></button>
                </div>
                <div id="chat-window" class="flex-grow p-4 space-y-4 overflow-y-auto"></div>
                <form id="chat-form" class="p-4 border-t dark:border-gray-700 flex gap-2">
                    <input type="text" id="chat-input" placeholder="Ask about your schedule..." class="flex-grow p-2 rounded-md dark:bg-gray-700 border-slate-300 dark:border-gray-600">
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-4 rounded-lg"><i data-lucide="send"></i></button>
                </form>
            </div>
        </div>
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // This is the main entry point for the application.
            App.init();
        });

        /**
         * @namespace App
         * @description Main application controller. Handles initialization and orchestrates other modules.
         */
        const App = {
            init() {
                try {
                    // Short delay to ensure all deferred scripts are loaded and ready.
                    setTimeout(() => {
                        this.loadModules();
                        UI.showToast("Welcome to AcaDexa!", "info");
                    }, 100);
                } catch (error) {
                    console.error("A critical error occurred during app initialization:", error);
                    UI.showFatalError();
                }
            },
            loadModules() {
                if (typeof lucide === 'undefined') throw new Error("Lucide icons library failed to load.");
                lucide.createIcons();

                UI.init();
                Database.load();
                EventListeners.setup();
                Calendar.init();
                Auth.checkSession();
            }
        };

        /**
         * @namespace Database
         * @description Handles all interactions with localStorage to simulate a database.
         */
        const Database = {
            _db: {},
            _initialData: {
                users: {
                    'admin@acadexa.com': { id: 'admin@acadexa.com', fullName: 'Dr. Evelyn Reed', role: 'admin', password: 'admin' },
                    'staff@acadexa.com': { id: 'staff@acadexa.com', fullName: 'Kashy', role: 'staff', password: 'staff' },
                    'student@acadexa.com': { id: 'student@acadexa.com', fullName: 'Yokesh', role: 'student', password: 'student', scheduleId: 'grade-10-a' }
                },
                schedules: {
                    'grade-10-a': {
                        name: 'Grade 10 - Section A',
                        events: {
                            'evt101': { id: 'evt101', title: 'Physics', prof: 'Kashy', start: '2025-10-06T09:00:00', end: '2025-10-06T10:00:00', backgroundColor: '#3b82f6', notes: 'Chapter 3: Motion.' },
                            'evt102': { id: 'evt102', title: 'Math', prof: 'Dr. Evelyn Reed', start: '2025-10-07T10:00:00', end: '2025-10-07T11:00:00', backgroundColor: '#ef4444', notes: 'Algebra review.' },
                        }
                    }
                },
                studentAttendance: { 'student@acadexa.com': {} },
            },
            load() {
                const savedDB = localStorage.getItem('acadexaDB');
                this._db = savedDB ? JSON.parse(savedDB) : JSON.parse(JSON.stringify(this._initialData));
                this.save();
            },
            save() {
                localStorage.setItem('acadexaDB', JSON.stringify(this._db));
            },
            get(key) {
                return this._db[key];
            },
            set(key, value) {
                this._db[key] = value;
                this.save();
            },
            findUserByEmail(email) {
                return this.get('users')[email];
            },
        };

        /**
         * @namespace Auth
         * @description Manages user authentication, sessions, and roles.
         */
        const Auth = {
            currentUser: null,
            activeLoginRole: null,
            
            checkSession() {
                const userId = sessionStorage.getItem('acadexaUser');
                if (userId) {
                    this.currentUser = Database.findUserByEmail(userId);
                    if (this.currentUser) {
                        UI.renderForLoggedInUser(this.currentUser);
                    }
                } else {
                    UI.renderForLoggedOutUser();
                }
            },
            
            login(email, password) {
                const user = Database.findUserByEmail(email);
                let isValid = false;

                if (user && user.password === password) {
                    if (this.activeLoginRole === 'staff' && (user.role === 'staff' || user.role === 'admin')) isValid = true;
                    else if (user.role === this.activeLoginRole) isValid = true;
                }

                if (isValid) {
                    this.currentUser = user;
                    sessionStorage.setItem('acadexaUser', user.id);
                    UI.hideModal('login-modal');
                    UI.renderForLoggedInUser(this.currentUser);
                    UI.showToast(`Welcome back, ${user.fullName}!`, 'success');
                } else {
                    document.getElementById('auth-error').textContent = "Invalid credentials for this role.";
                }
            },
            
            logout() {
                this.currentUser = null;
                sessionStorage.removeItem('acadexaUser');
                UI.renderForLoggedOutUser();
                UI.showToast("You have been logged out.", "info");
            }
        };

        /**
         * @namespace UI
         * @description Controls all direct manipulation of the DOM.
         */
        const UI = {
            init() {
                document.getElementById('modals-container').innerHTML = document.getElementById('modals-template').innerHTML;
                this.setupDarkMode();
            },

            renderForLoggedInUser(user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('user-info-container').classList.remove('hidden');
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('app-wrapper').classList.remove('hidden');
                document.getElementById('ask-ai-btn').classList.remove('hidden');

                document.getElementById('username-display').textContent = user.fullName;

                const isStaffOrAdmin = user.role === 'staff' || user.role === 'admin';
                document.getElementById('attendance-btn').classList.toggle('hidden', !isStaffOrAdmin);
                document.getElementById('notifications-btn').classList.toggle('hidden', !isStaffOrAdmin);
                document.getElementById('staff-schedule-tools').classList.toggle('hidden', !isStaffOrAdmin);
                document.getElementById('staff-schedule-filters').classList.toggle('hidden', !isStaffOrAdmin);

                if (isStaffOrAdmin) {
                    this.renderStaffDashboard();
                } else {
                    this.renderStudentDashboard();
                }

                this.populateSelectors(user);
                const defaultSchedule = user.role === 'student' ? user.scheduleId : Object.keys(Database.get('schedules'))[0];
                Calendar.loadSchedule(defaultSchedule);
            },

            renderForLoggedOutUser() {
                document.getElementById('auth-container').classList.remove('hidden');
                document.getElementById('user-info-container').classList.add('hidden');
                document.getElementById('welcome-screen').classList.remove('hidden');
                document.getElementById('app-wrapper').classList.add('hidden');
                document.getElementById('ask-ai-btn').classList.add('hidden');
            },

            renderStudentDashboard() {
                const user = Auth.currentUser;
                const attendance = Database.get('studentAttendance')[user.id] || {};
                const total = Object.keys(attendance).length;
                const attended = Object.values(attendance).filter(status => status === 'Present').length;
                const percentage = total > 0 ? ((attended / total) * 100).toFixed(1) : 100;
                
                document.getElementById('student-dashboard').innerHTML = `
                    <h2 class="text-3xl font-bold mb-6 font-poppins">Student Dashboard</h2>
                    <div class="bg-white dark:bg-gray-800/50 p-6 rounded-xl shadow-md text-center">
                        <h3 class="font-bold text-lg mb-2">Overall Attendance</h3>
                        <p class="text-5xl font-bold text-indigo-500">${percentage}%</p>
                    </div>`;
                document.getElementById('student-dashboard').classList.remove('hidden');
            },
            
            renderStaffDashboard() {
                const isAdmin = Auth.currentUser.role === 'admin';
                const adminControls = isAdmin ? `
                    <div class="mt-8 bg-amber-50 dark:bg-amber-900/20 p-6 rounded-xl shadow-md">
                        <h3 class="font-bold text-lg mb-4 font-poppins">Admin Controls</h3>
                        <p>System settings would go here.</p>
                    </div>` : '';

                document.getElementById('staff-dashboard').innerHTML = `
                    <h2 class="text-3xl font-bold mb-6 font-poppins">Staff Dashboard</h2>
                    ${adminControls}
                    <div class="mt-6 bg-white dark:bg-gray-800/50 p-6 rounded-xl shadow-md">
                        <h3 class="font-bold text-lg mb-4">Analytics</h3>
                        <canvas id="workload-chart"></canvas>
                    </div>`;
                document.getElementById('staff-dashboard').classList.remove('hidden');
                this.renderWorkloadChart();
            },

            renderWorkloadChart() {
                if (typeof Chart === 'undefined') return;
                const ctx = document.getElementById('workload-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Kashy', 'Dr. Evelyn Reed'],
                        datasets: [{ label: 'Classes this Week', data: [1, 1], backgroundColor: '#4f46e5' }]
                    },
                    options: { scales: { y: { beginAtZero: true } } }
                });
            },

            populateSelectors(user) {
                const scheduleSelector = document.getElementById('schedule-selector');
                scheduleSelector.innerHTML = Object.entries(Database.get('schedules'))
                    .map(([id, data]) => `<option value="${id}">${data.name}</option>`).join('');

                if (user.role === 'staff' || user.role === 'admin') {
                    const staffSelector = document.getElementById('staff-view-selector');
                    const staffList = Object.values(Database.get('users')).filter(u => u.role === 'staff' || u.role === 'admin');
                    staffSelector.innerHTML = `<option value="all">Full Class View</option>` +
                        staffList.map(s => `<option value="${s.fullName}">${s.fullName} (Personal)</option>`).join('');
                    staffSelector.value = user.fullName; // Default to personal view
                }
            },
            
            showModal(id) { document.getElementById(id)?.classList.add('visible'); },
            hideModal(id) { document.getElementById(id)?.classList.remove('visible'); },
            
            setupDarkMode() {
                const toggle = document.getElementById('dark-mode-toggle');
                const toggleIcon = toggle.querySelector('i');
                const applyDarkMode = (isDark) => {
                    document.documentElement.classList.toggle('dark', isDark);
                    toggleIcon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
                    lucide.createIcons();
                };
                toggle.onclick = () => {
                    const isDark = document.documentElement.classList.toggle('dark');
                    localStorage.setItem('darkMode', isDark);
                    applyDarkMode(isDark);
                };
                applyDarkMode(localStorage.getItem('darkMode') === 'true');
            },

            showToast(message, type = "info", duration = 3000) {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toast-message');
                toast.className = 'fixed top-24 left-1/2 -translate-x-1/2 text-white py-2 px-5 rounded-lg shadow-lg opacity-0 transform -translate-y-10 z-[90] transition-all duration-300'; // Reset classes
                const colors = { error: 'bg-red-600', success: 'bg-green-600', info: 'bg-indigo-500' };
                toast.classList.add(colors[type] || 'bg-gray-800');
                toastMessage.textContent = message;
                toast.classList.remove('opacity-0', '-translate-y-10');
                
                setTimeout(() => toast.classList.add('opacity-0', '-translate-y-10'), duration);
            },
            
            showFatalError() {
                document.body.innerHTML = `<div class="p-10 text-center font-sans"><h1>Application Error</h1><p>A critical error occurred. Please check the console (F12) for details.</p></div>`;
            }
        };

        /**
         * @namespace Calendar
         * @description Manages the FullCalendar instance.
         */
        const Calendar = {
            instance: null,
            init() {
                if (typeof FullCalendar === 'undefined') throw new Error("FullCalendar library not loaded.");
                const calendarEl = document.getElementById('calendar-container');
                this.instance = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'timeGridWeek',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    editable: true,
                    droppable: true,
                    eventClick: this.handleEventClick,
                });
                this.instance.render();
            },
            
            loadSchedule(scheduleId) {
                document.getElementById('schedule-selector').value = scheduleId;
                this.render();
            },
            
            render() {
                const scheduleId = document.getElementById('schedule-selector').value;
                const schedule = Database.get('schedules')[scheduleId];
                if (!schedule) return;

                let events = Object.values(schedule.events);
                const viewFilter = document.getElementById('staff-view-selector').value;

                if (Auth.currentUser.role !== 'student' && viewFilter !== 'all') {
                    events = events.filter(e => e.prof === viewFilter);
                }
                
                this.instance.removeAllEvents();
                this.instance.addEventSource(events);
            },

            handleEventClick(info) {
                const event = info.event;
                const modal = document.getElementById('class-details-modal');
                modal.querySelector('#class-modal-title').textContent = event.title;
                modal.querySelector('#class-modal-time').textContent = `${event.start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${event.end.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                modal.querySelector('#class-modal-notes-content').innerHTML = `<p>${event.extendedProps.notes || 'No notes for this class.'}</p>`;
                
                const actionContainer = modal.querySelector('#action-container');
                actionContainer.innerHTML = '';

                if (Auth.currentUser.role === 'staff' || Auth.currentUser.role === 'admin') {
                     actionContainer.innerHTML += `<button class="w-full text-center bg-sky-600 text-white font-bold py-2 rounded-lg" onclick="UI.hideModal('class-details-modal'); UI.showModal('student-attendance-modal');">Mark Student Attendance</button>`;
                }
                if (Auth.currentUser.role === 'admin' || event.extendedProps.prof === Auth.currentUser.fullName) {
                    actionContainer.innerHTML += `<button class="w-full text-center bg-red-600 text-white font-bold py-2 rounded-lg">Remove Class</button>`;
                }

                UI.showModal('class-details-modal');
            }
        };

        /**
         * @namespace EventListeners
         * @description Sets up all event listeners for the application.
         */
        const EventListeners = {
            setup() {
                document.getElementById('student-login-btn').onclick = () => { Auth.activeLoginRole = 'student'; UI.showModal('login-modal'); };
                document.getElementById('staff-login-btn').onclick = () => { Auth.activeLoginRole = 'staff'; UI.showModal('login-modal'); };
                document.getElementById('admin-login-btn').onclick = () => { Auth.activeLoginRole = 'admin'; UI.showModal('login-modal'); };
                
                document.getElementById('logout-btn').onclick = () => Auth.logout();
                document.getElementById('auth-form').onsubmit = (e) => {
                    e.preventDefault();
                    Auth.login(document.getElementById('auth-email').value, document.getElementById('auth-password').value);
                };

                document.getElementById('schedule-selector').onchange = () => Calendar.render();
                document.getElementById('staff-view-selector').onchange = () => Calendar.render();
                document.getElementById('ask-ai-btn').onclick = () => UI.showModal('ai-chat-modal');
                
                // Use event delegation for dynamically created elements like modal close buttons
                document.body.addEventListener('click', (e) => {
                    if (e.target.closest('.close-modal-btn')) {
                        UI.hideModal(e.target.closest('.modal').id);
                    }
                });
            }
        };

    </script>
</body>
</html>
